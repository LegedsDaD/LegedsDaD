name: Real Cinematic Snake Battle

on:
  schedule:
    - cron: "0 */12 * * *"
  workflow_dispatch:

permissions:
  contents: write

jobs:
  cinematic:
    runs-on: ubuntu-latest

    steps:

      - name: Checkout output branch
        uses: actions/checkout@v4
        with:
          ref: output
        continue-on-error: true

      - name: Create dist folder
        run: mkdir -p dist

      ##################################################
      # Generate real contribution snake
      ##################################################

      - name: Generate snake
        uses: Platane/snk@v3
        with:
          github_user_name: ${{ github.repository_owner }}
          outputs: dist/snake.svg

      ##################################################
      # Generate REAL CINEMATIC SVG
      ##################################################

      - name: Generate cinematic svg
        run: |
          cat <<'EOF' > dist/real-cinematic-mode.svg

          <svg xmlns="http://www.w3.org/2000/svg"
               width="1100"
               height="420"
               viewBox="0 0 1100 420">

          <style>

          /* cinematic bars */
          .bar {
            fill:black;
          }

          /* screen shake */
          .screen {
            animation: shake 12s infinite;
          }

          @keyframes shake {
            0%,48%,100% { transform:translate(0,0); }
            50% { transform:translate(-4px,2px); }
            52% { transform:translate(4px,-2px); }
            54% { transform:translate(-3px,1px); }
            56% { transform:translate(0,0); }
          }

          /* bullets */
          .bullet {
            fill:#ffff00;
            opacity:0;
            animation: bullet 12s infinite linear;
          }

          @keyframes bullet {
            0%,40% { opacity:0; }
            45% { opacity:1; }
            55% { transform:translateX(900px); opacity:1; }
            60% { opacity:0; }
          }

          /* explosion flash */
          .flash {
            fill:white;
            opacity:0;
            animation: flash 12s infinite;
          }

          @keyframes flash {
            0%,48% { opacity:0; }
            50% { opacity:1; }
            52% { opacity:0; }
          }

          /* explosion shockwave */
          .shockwave {
            stroke:#ff6600;
            stroke-width:4;
            fill:none;
            opacity:0;
            animation: shockwave 12s infinite;
          }

          @keyframes shockwave {
            0%,50% { r:10; opacity:0; }
            52% { opacity:1; }
            60% { r:200; opacity:0; }
          }

          /* boss snake */
          .boss {
            fill:#ff0033;
            opacity:0;
            animation: boss 12s infinite;
          }

          @keyframes boss {
            0%,55% { opacity:0; transform:scale(0.3); }
            60% { opacity:1; transform:scale(1); }
            85% { opacity:1; }
            90% { opacity:0; }
          }

          /* tank */
          .tank {
            fill:#00ffaa;
            opacity:0;
            animation: tank 12s infinite;
          }

          @keyframes tank {
            0%,70% { opacity:0; transform:translateX(-300px); }
            75% { opacity:1; transform:translateX(200px); }
            90% { transform:translateX(400px); }
            100% { opacity:0; }
          }

          /* tank recoil */
          .recoil {
            animation: recoil 12s infinite;
          }

          @keyframes recoil {
            80% { transform:translateX(-10px); }
            82% { transform:translateX(0px); }
          }

          /* muzzle flash */
          .muzzle {
            fill:orange;
            opacity:0;
            animation:muzzle 12s infinite;
          }

          @keyframes muzzle {
            80% { opacity:1; }
            82% { opacity:0; }
          }

          /* scanlines */
          .scan line {
            stroke:black;
            stroke-width:1;
            opacity:0.1;
          }

          </style>


          <!-- cinematic bars -->
          <rect class="bar" x="0" y="0" width="1100" height="40"/>
          <rect class="bar" x="0" y="380" width="1100" height="40"/>


          <g class="screen">

          <!-- real snake -->
          <image href="snake.svg"
                 x="0"
                 y="80"
                 width="1100"
                 height="240"/>


          <!-- bullets -->
          <circle class="bullet" cx="50" cy="200" r="6"/>
          <circle class="bullet" cx="100" cy="220" r="6"/>
          <circle class="bullet" cx="150" cy="180" r="6"/>


          <!-- explosion flash -->
          <rect class="flash"
                x="0"
                y="0"
                width="1100"
                height="420"/>


          <!-- shockwave -->
          <circle class="shockwave"
                  cx="700"
                  cy="200"
                  r="10"/>


          <!-- boss snake -->
          <rect class="boss"
                x="600"
                y="150"
                width="300"
                height="120"
                rx="60"/>


          <!-- tank -->
          <g class="tank recoil">

            <rect x="0" y="260" width="140" height="50"/>

            <rect x="120"
                  y="240"
                  width="120"
                  height="20"/>

            <!-- muzzle flash -->
            <circle class="muzzle"
                    cx="240"
                    cy="250"
                    r="20"/>

          </g>

          </g>

          </svg>

          EOF


      ##################################################
      # Commit and push
      ##################################################

      - name: Commit
        run: |
          git config user.name github-actions
          git config user.email github-actions@github.com
          git add dist/*.svg
          git commit -m "Update real cinematic battle" || echo "No changes"

      - name: Push
        uses: ad-m/github-push-action@master
        with:
          branch: output
          github_token: ${{ secrets.GITHUB_TOKEN }}
